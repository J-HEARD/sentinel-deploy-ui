id: baseline-admin-privilege-escalation
name: Baseline - Admin Privilege Escalation Detection
description: |
  Baseline Content Pack - Detects potential privilege escalation attempts in Azure AD.
  This rule monitors for users being added to administrative roles or groups.
  
  Data Sources: AzureActivity (AuditLogs)
  Severity: Medium
  Tactics: Privilege Escalation
  Techniques: T1078.004

severity: Medium
enabled: true
query: |
  AzureActivity
  | where OperationName in ("Add member to role", "Add member to group", "Add user to role")
  | where ActivityStatus == "Success"
  | where Caller contains "@" or Caller contains "service"
  | extend 
      RoleName = tostring(parse_json(Properties).roleDefinitionName),
      GroupName = tostring(parse_json(Properties).groupName),
      TargetUser = tostring(parse_json(Properties).userPrincipalName)
  | where isnotempty(RoleName) or isnotempty(GroupName)
  | where RoleName contains "Admin" or RoleName contains "Global" or GroupName contains "Admin"
  | project 
      TimeGenerated,
      Caller,
      OperationName,
      RoleName,
      GroupName,
      TargetUser,
      ResourceGroup,
      SubscriptionId

queryFrequency: 1h
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
suppressionDuration: 1h
suppressionEnabled: false
tactics:
  - Privilege_Escalation
techniques:
  - T1078.004
tags:
  - baseline
  - privilege-escalation
  - azure-ad
  - admin-roles 