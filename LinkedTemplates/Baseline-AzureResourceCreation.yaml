id: baseline-azure-resource-creation
name: Baseline - Suspicious Azure Resource Creation
description: |
  Baseline Content Pack - Detects suspicious creation of Azure resources that may indicate unauthorized access or potential security risks.
  This rule monitors for creation of VMs, storage accounts, and other critical resources.
  
  Data Sources: AzureActivity
  Severity: Medium
  Tactics: Defense Evasion, Persistence
  Techniques: T1078, T1098

severity: Medium
enabled: true
query: |
  AzureActivity
  | where OperationName contains "Create"
  | where ActivityStatus == "Success"
  | where ResourceType in (
      "Microsoft.Compute/virtualMachines",
      "Microsoft.Storage/storageAccounts", 
      "Microsoft.Network/networkInterfaces",
      "Microsoft.KeyVault/vaults",
      "Microsoft.Web/sites"
  )
  | extend 
      ResourceName = tostring(parse_json(Properties).resourceName),
      ResourceGroup = tostring(parse_json(Properties).resourceGroup),
      Location = tostring(parse_json(Properties).location),
      SubscriptionId = tostring(parse_json(Properties).subscriptionId)
  | where isnotempty(ResourceName)
  | summarize 
      ResourceCount = count(),
      Resources = make_set(ResourceName),
      ResourceTypes = make_set(ResourceType),
      Locations = make_set(Location)
      by Caller, ResourceGroup, bin(TimeGenerated, 1h)
  | where ResourceCount > 3  // Multiple resources created in short time
  | project 
      TimeGenerated,
      Caller,
      ResourceGroup,
      ResourceCount,
      Resources,
      ResourceTypes,
      Locations

queryFrequency: 30m
queryPeriod: 1h
triggerOperator: gt
triggerThreshold: 0
suppressionDuration: 2h
suppressionEnabled: true
tactics:
  - Defense_Evasion
  - Persistence
techniques:
  - T1078
  - T1098
tags:
  - baseline
  - azure-resources
  - resource-creation
  - unauthorized-access 